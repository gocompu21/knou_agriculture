{% extends "base.html" %}

{% block title %}{{ exam }} 풀이 | 기사시험{% endblock %}

{% block extra_css %}
<style>
    .site-header, .site-footer { display: none !important; }
    main { padding: 0 !important; }
    body { background: #fff !important; }

    .exam-form { display: flex; min-height: 100vh; max-width: 1400px; margin: 0 auto; }
    .exam-left { flex: 1; padding: 20px; overflow-y: auto; }
    .exam-right { width: 260px; background: #f8f9fa; border-left: 1px solid #e0e0e0; padding: 20px; position: sticky; top: 0; height: 100vh; overflow-y: auto; }

    .exam-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; background: #1a237e; color: #fff; position: sticky; top: 0; z-index: 100; }
    .exam-header h2 { font-size: 1rem; font-weight: 700; }
    .exam-header a { color: #fff; text-decoration: none; opacity: 0.8; }
    .exam-header a:hover { opacity: 1; }

    .q-block { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 24px; margin-bottom: 20px; }
    .q-num { font-weight: 700; color: #1a237e; font-size: 1.1em; margin-bottom: 8px; }
    .q-subject-tag { display: inline-block; background: #e8eaf6; color: #3949ab; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; }
    .q-text { font-size: 1.05em; line-height: 1.6; margin-bottom: 16px; font-weight: 600; }
    .q-options label { display: block; padding: 8px 12px; margin-bottom: 4px; border-radius: 6px; cursor: pointer; transition: background 0.15s; font-size: 0.95em; }
    .q-options label:hover { background: #e8eaf6; }
    .q-options input[type="radio"] { margin-right: 8px; }

    /* OMR */
    .omr-title { font-weight: 700; font-size: 0.95rem; color: #333; margin-bottom: 16px; text-align: center; }
    .omr-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin-bottom: 20px; }
    .omr-cell { text-align: center; padding: 6px 0; border-radius: 4px; font-size: 0.78rem; font-weight: 600; cursor: pointer; transition: background 0.15s; background: #fff; border: 1px solid #e0e0e0; color: #666; }
    .omr-cell:hover { background: #e8eaf6; }
    .omr-cell.answered { background: #3949ab; color: #fff; border-color: #3949ab; }
    .omr-cell.current { border-color: #ff6f00; border-width: 2px; }
    .omr-submit { width: 100%; padding: 12px; background: #1a237e; color: #fff; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; }
    .omr-submit:hover { background: #283593; }

    .mobile-header { display: none; background: #1a237e; color: #fff; padding: 12px 16px; position: sticky; top: 0; z-index: 100; }
    .mobile-header h2 { font-size: 0.95rem; font-weight: 700; margin: 0; }
    .mobile-submit { display: none; position: fixed; bottom: 0; left: 0; right: 0; padding: 12px 16px; background: #fff; border-top: 1px solid #e0e0e0; z-index: 100; }
    .mobile-submit button { width: 100%; padding: 14px; background: #1a237e; color: #fff; border: none; border-radius: 10px; font-size: 1.05rem; font-weight: 700; cursor: pointer; font-family: inherit; }

    @media (max-width: 768px) {
        .exam-form { display: block; }
        .exam-right { display: none; }
        .exam-header { display: none; }
        .mobile-header { display: block; }
        .mobile-submit { display: block; }
        .exam-left { padding: 10px 10px 80px; }
        .q-block { padding: 16px 12px; margin-bottom: 12px; }
    }
</style>
{% endblock %}

{% block content %}
<div class="mobile-header">
    <h2>{{ cert.name }} {{ exam.year }}년 {{ exam.round }}회</h2>
</div>

<form method="post" action="{% url 'gisa:exam_submit' cert.pk exam.pk %}" class="exam-form" id="examForm">
    {% csrf_token %}

    <!-- Left: Questions -->
    <div class="exam-left">
        <div class="exam-header">
            <h2>{{ cert.name }} {{ exam.year }}년 {{ exam.round }}회 {{ exam.exam_type }}</h2>
            <a href="{% url 'gisa:certification_detail' cert.pk %}">돌아가기</a>
        </div>

        {% for q in questions %}
        <div class="q-block" id="q-{{ forloop.counter }}">
            <div class="q-subject-tag">{{ q.subject.name }}</div>
            <div class="q-num">{{ q.number }}번</div>
            <div class="q-text">{{ q.text }}</div>
            <div class="q-options" data-qidx="{{ forloop.counter }}">
                <label><input type="radio" name="question_{{ q.id }}" value="1" onchange="markAnswered({{ forloop.counter }})"> ① {{ q.choice_1 }}</label>
                <label><input type="radio" name="question_{{ q.id }}" value="2" onchange="markAnswered({{ forloop.counter }})"> ② {{ q.choice_2 }}</label>
                <label><input type="radio" name="question_{{ q.id }}" value="3" onchange="markAnswered({{ forloop.counter }})"> ③ {{ q.choice_3 }}</label>
                <label><input type="radio" name="question_{{ q.id }}" value="4" onchange="markAnswered({{ forloop.counter }})"> ④ {{ q.choice_4 }}</label>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Right: OMR -->
    <div class="exam-right">
        <div class="omr-title">OMR 답안표</div>
        <div class="omr-grid">
            {% for q in questions %}
            <div class="omr-cell" id="omr-{{ forloop.counter }}" onclick="scrollToQ({{ forloop.counter }})">{{ forloop.counter }}</div>
            {% endfor %}
        </div>
        <button type="submit" class="omr-submit" onclick="return confirm('답안을 제출할까요?')">답안 제출</button>
    </div>
</form>

<div class="mobile-submit">
    <button type="submit" form="examForm" onclick="return confirm('답안을 제출할까요?')">답안 제출</button>
</div>
{% endblock %}

{% block extra_js %}
<script>
function markAnswered(idx) {
    var cell = document.getElementById('omr-' + idx);
    if (cell) cell.classList.add('answered');
}
function scrollToQ(idx) {
    var el = document.getElementById('q-' + idx);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
}
</script>
{% endblock %}
